/**
 * MUSE — единый конфиг цен и подсказок для всех калькуляторов
 * Обновлено: 17 февраля 2026
 *
 * ❗ При смене цен — проверьте SEO-тексты на страницах!
 *   Цены упоминаются в текстах секций («от N р.»), JSON-LD, meta description.
 *   Поиск по проекту: grep -r "от [0-9]" src/html/ — найдёт упоминания цен в HTML.
 *
 * Универсальная формула (canvas + portrait):
 *   Печать+подрамник = 0.29·S + 0.04·P·stretcherPrice + 0.76·P + 1998.48
 *     где S = w×h (см²), P = (w+h)×2 (см)
 *   Лак       = S × 0.1
 *   Гель      = S × 0.375   (только portrait)
 *   Акрил     = S × 1.05    (только portrait)
 *   Масло     = S × 2 + (лица − 1) × 2400  (только portrait)
 *   Поталь    = S × 0.3     (только portrait)
 */

/* ═══════════════════════════════════════════════════════════════
 *  MUSE_TOOLTIPS — единые тексты подсказок калькулятора.
 *  Используется во всех CalcInit({ tooltips: MUSE_TOOLTIPS.portrait }).
 *  Редактировать здесь — изменения автоматически применяются на всех страницах.
 * ═══════════════════════════════════════════════════════════════ */
window.MUSE_TOOLTIPS = Object.freeze({

  /* ── Подсказки для портретных страниц (type: 'portrait') ── */
  portrait: Object.freeze({
    faces: 'Стоимость цифрового портрета зависит от количества лиц на картине. Каждое дополнительное лицо требует отдельной детальной прорисовки черт, светотени и выражения, поэтому стоимость увеличивается пропорционально.',
    gel: 'Гель придаёт плоскому отпечатку физический объём и текстуру, имитируя мазки кисти. Мастер вручную наносит прозрачный гель-медиум специальной кистью, повторяя направление мазков. После высыхания поверхность выглядит и ощущается на ощупь как настоящая живопись.',
    acrylic: 'Прорисовка акрилом — это художественный приём, при котором художник поверх готового отпечатка вручную добавляет акриловые мазки. Каждый штрих индивидуален, что делает работу неповторимой. Акрил быстро сохнет, образует прочную плёнку и со временем не желтеет.',
    oil: 'Отпечатанную работу по Вашему желанию художник может отрисовать сверху маслом. Масляные краски позволяют добиться глубоких, насыщенных тонов и плавных переходов, недоступных другим техникам. Масло сохнет медленнее, но после полимеризации образует прочный и долговечный красочный слой.',
    potal: 'Покрытие поталью — это ручная работа художника, который наклеивает тончайшие листы имитации сусального золота или серебра на выбранные участки картины (фон, элементы одежды, декоративные детали). Поталь придаёт портрету роскошный вид и уникальный блеск.',
    digitalMockup: 'Цифровой макет без изготовления картины — это полностью подготовленный к печати файл высокого разрешения. Вы получаете готовый цифровой портрет, который можете использовать для самостоятельной печати, публикации в соцсетях или в качестве цифрового подарка.',
    varnish: 'Защитный лак предотвращает выцветание красок от ультрафиолета, защищает поверхность от влаги и механических повреждений. Наносится после полного высыхания картины тонким равномерным слоем.',
    gift: 'Крафт-бумага, атласная лента и персональная открытка — идеальный вариант, если картина приобретается в подарок.'
  }),

  /* ── Подсказки для canvas-страниц (фото на холсте) ── */
  canvas: Object.freeze({
    varnish: 'Дополнительно. Оригинальные чернила не выцветают десятилетиями, поэтому нет строгой необходимости в покрытии лаком. Но мы рекомендуем лак, потому что будет легче ухаживать за картиной, например, протирать пыль. Кроме того, лак выравнивает легкий глянец на отпечатке.',
    gift: 'Дополнительно. Упакуем работу в подарочную бумагу с красивым бантом. Предложение с вариантами упаковки обязательно пришлем на согласование.'
  }),

  /* ── Подсказки для портретных стилей (type: 'portraitStyle') ── */
  portraitStyle: Object.freeze({
    style: 'Выберите стиль, в котором будет нарисован портрет. Стоимость работы художника зависит от выбранного стиля.',
    faces: 'Стоимость цифрового портрета зависит от количества лиц на картине. Каждое дополнительное лицо требует отдельной детальной прорисовки черт, светотени и выражения, поэтому стоимость увеличивается пропорционально.',
    varnish: 'Защитный лак предотвращает выцветание красок от ультрафиолета, защищает поверхность от влаги и механических повреждений. Наносится после полного высыхания картины тонким равномерным слоем.',
    gift: 'Крафт-бумага, атласная лента и персональная открытка — идеальный вариант, если картина приобретается в подарок.'
  }),

  /* ── Подсказки для frame-страниц (фото в рамке) ── */
  frame: Object.freeze({
    passepartout: 'Паспарту — это цветной картонный кант между фотографией и рамой. Придаёт работе законченный, музейный вид, визуально увеличивает изображение и защищает фото от соприкосновения со стеклом.',
    gift: 'Дополнительно. Упакуем работу в подарочную бумагу с красивым бантом. Предложение с вариантами упаковки обязательно пришлем на согласование.'
  })
});

window.MUSE_PRICES = (function () {

  /* ───── Общие параметры (меняете здесь — применяется везде) ───── */
  var shared = {
    /* Печать + подрамник: 0.29·S + 0.04·P·price + 0.76·P + 1998.48 */
    printSqCoeff:     0.29,
    printPStrCoeff:   0.04,
    printPBaseCoeff:  0.76,
    printConst:    1998.48,
    stretcherStandard:  32,
    stretcherGallery:   68,
    stretcherRoll:      32,

    /* Покрытия */
    varnishCoeff:   0.10,    // лак: S × 0.1

    /* Подарочная упаковка — по размеру */
    giftWrapTiers: [
      { maxW: 50,  maxH:  70, price:  650 },
      { maxW: 60,  maxH:  90, price:  750 },
      { maxW: 90,  maxH: 120, price: 1200 }
    ],
    giftWrapOversizeLabel: 'по согласованию',

    /* Багет — legacy fallback.
     * Эти значения используются ТОЛЬКО если у рамы нет поля pricePerM.
     * На продакшене каждая рама получает индивидуальный pricePerM
     * из серверных данных (cfg.frames через Bitrix API).
     * См. docs/CALCULATOR.md §10.3 — контракт API каталога рам. */
    framePerM:           1200,   // fallback: цена за п.м. для STUDIO
    frameClassicMult:     1.5    // fallback: множитель для CLASSIC (1200 × 1.5 = 1800)
  };

  /** Копирует все ключи из shared + extras в новый объект */
  function merge(extras) {
    var result = {};
    var k;
    for (k in shared) { if (shared.hasOwnProperty(k)) result[k] = shared[k]; }
    for (k in extras) { if (extras.hasOwnProperty(k)) result[k] = extras[k]; }
    return result;
  }

  /** Deep-freeze: защита от случайных мутаций во время runtime */
  function deepFreeze(obj) {
    Object.freeze(obj);
    Object.keys(obj).forEach(function (key) {
      var val = obj[key];
      if (val && typeof val === 'object' && !Object.isFrozen(val)) {
        deepFreeze(val);
      }
    });
    return obj;
  }

  var result = {
    /* ───── Печать на холсте ───── */
    canvas: merge({
      /* Обработка фото (только для холста) */
      processingOptions: [
        { value: 0,    label: 'Базовая' },
        { value: 499,  label: 'Оптимальная' },
        { value: 999,  label: 'Премиальная' }
      ]
    }),

    /* ───── Портрет ───── */
    portrait: merge({
      /* Количество лиц */
      faceFirst:       1920,   // первое лицо
      faceExtra:        960,   // каждое следующее

      /* Цифровой макет (без печати): другие цены на лица */
      digitalFaceFirst: 3600,
      digitalFaceExtra: 1200,

      /* Покрытия — коэффициент × S (см²) */
      gelCoeff:       0.375,   // гель
      acrylicCoeff:   1.05,    // акрил
      oilCoeff:       2,       // масло: S × 2
      oilFaceExtra:   2400,    // масло: + (лица − 1) × 2400
      potalCoeff:     0.30     // поталь
    }),

    /* ───── Фото в рамке ───── */
    frame: merge({
      /*
       * Печать на фотобумаге: 0.0023 × S(см²) × basePrice
       *   basePrice = 897 р. (включает: фотобумага + акриловое стекло + рамка)
       *   Коэфф: 0.0023 × 897 = 2.0631
       */
      framePrintCoeff:   2.0631,   // 0.0023 × 897

      /* Паспарту: S(см²) × 1 р.  (чекбокс, OFF по умолч.) */
      passepartoutCoeff: 1,

      /* Минимальный размер — 20 × 30 см */
      minWidth:  20,
      minHeight: 30,

      /* Рамка по умолчанию (ID из каталога DEFAULT_FRAMES) */
      defaultFrameId: 'ST_BLACK_M',

      /* Обработка фото (те же опции, что и canvas) */
      processingOptions: [
        { value: 0,    label: 'Базовая' },
        { value: 499,  label: 'Оптимальная' },
        { value: 999,  label: 'Премиальная' }
      ]
    }),

    /* ───── Портрет по фото — стили ───── */
    portraitStyle: merge({
      /* Количество лиц (общее для всех обычных стилей) */
      faceExtra: 960,

      /* Стили рисования:
       *   faceFirst — стоимость первого лица (работа художника)
       *   faceExtra — стоимость каждого следующего лица
       *   fixedFaces — если задано, кол-во лиц фиксировано (select блокируется)
       */
      styles: [
        { id: 'OIL_STYLE',     name: 'Под масло',                faceFirst: 1920, faceExtra: 960 },
        { id: 'WATERCOLOR',    name: 'Портрет акварелью',        faceFirst: 1920, faceExtra: 960 },
        { id: 'PENCIL',        name: 'Портрет карандашом',       faceFirst: 1920, faceExtra: 960 },
        { id: 'COSTUME',       name: 'Портрет в образе',         faceFirst: 1920, faceExtra: 960 },
        { id: 'CARICATURE',    name: 'Шарж по фото',            faceFirst: 1920, faceExtra: 960 },
        { id: 'MOSAIC',        name: 'Мозаика',                  faceFirst: 1920, faceExtra: 960 },
        { id: 'MOSAIC_PRO',    name: 'Мозаика с прорисовкой',   faceFirst: 3840, faceExtra: 960 },
        { id: 'DREAM_ART',     name: 'Дрим-арт портрет',        faceFirst: 1920, faceExtra: 960 },
        { id: 'BEAUTY_ART',    name: 'Бьюти-арт',               faceFirst: 1920, faceExtra: 960 },
        { id: 'POP_ART',       name: 'Поп-арт портрет',         faceFirst: 1920, faceExtra: 960 },
        { id: 'WPAP',          name: 'WPAP портрет',            faceFirst: 1920, faceExtra: 960 },
        { id: 'GRUNGE',        name: 'Гранж портрет',           faceFirst: 1920, faceExtra: 960 },
        { id: 'WORDS',         name: 'Из слов по фото',         faceFirst: 1920, faceExtra: 960 },
        { id: 'WORDS_PRO',     name: 'Из слов с прорисовкой',   faceFirst: 3840, faceExtra: 960 },
        { id: 'FLOWER_ART',    name: 'Flower Art',               faceFirst: 1920, faceExtra: 960 },
        { id: 'COMICS',        name: 'Комикс',                   faceFirst: 1920, faceExtra: 960 },
        { id: 'LOVEIS_PHOTO',  name: 'Love is...из фото',       faceFirst: 2280, faceExtra: 0, fixedFaces: 2 },
        { id: 'LOVEIS_DRAWN',  name: 'Рисованный Love is...',   faceFirst: 2880, faceExtra: 0, fixedFaces: 2 },
        { id: 'GRAFFITI',      name: 'Граффити',                 faceFirst: 1920, faceExtra: 960 },
        { id: 'LOW_POLY',      name: 'Лоу-поли',                faceFirst: 1920, faceExtra: 960 },
        { id: 'FANTASY',       name: 'Фэнтези',                 faceFirst: 1920, faceExtra: 960 }
      ]
    })
  };

  return deepFreeze(result);
})();
