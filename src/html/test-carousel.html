<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест каруселей - сравнение решений</title>
    <link rel="stylesheet" href="css/output.css">
    <style>
        .test-section {
            margin: 4rem 0;
            padding: 2rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
        }
        .test-section h2 {
            margin-bottom: 1rem;
            color: #1f2937;
        }
        .test-section p {
            margin-bottom: 2rem;
            color: #6b7280;
        }
        .carousel-item {
            width: 223px;
            flex-shrink: 0;
        }
        .carousel-item img {
            width: 100%;
            height: auto;
            border-radius: 8px;
        }
    </style>
</head>
<body class="bg-white">
    <div class="container mx-auto py-12 px-4">
        <h1 class="text-3xl font-bold text-center mb-8">Тест каруселей - сравнение решений</h1>
        
        <div class="test-section">
            <h2 class="text-2xl">Решение 1: Текущее (оптимизированное)</h2>
            <p>Улучшенная версия текущего кода с минимизацией forced reflows</p>
            
            <div class="carousel-scroll-v1 scrollbar-hide pb-4" style="overflow-x: auto; scroll-behavior: smooth; scroll-snap-type: x mandatory;">
                <div class="flex gap-4 px-4" style="min-width: max-content;">
                    <div class="carousel-item snap-center">
                        <img src="https://muse.ooo/upload/img/watercolor-couple-223-297.webp" alt="Портрет 1" width="223" height="297" loading="lazy">
                    </div>
                    <div class="carousel-item snap-center">
                        <img src="https://muse.ooo/upload/img/watercolor-couple-223-297.webp" alt="Портрет 2" width="223" height="297" loading="lazy">
                    </div>
                    <div class="carousel-item snap-center">
                        <img src="https://muse.ooo/upload/img/watercolor-couple-223-297.webp" alt="Портрет 3" width="223" height="297" loading="lazy">
                    </div>
                    <div class="carousel-item snap-center">
                        <img src="https://muse.ooo/upload/img/watercolor-couple-223-297.webp" alt="Портрет 4" width="223" height="297" loading="lazy">
                    </div>
                    <div class="carousel-item snap-center">
                        <img src="https://muse.ooo/upload/img/watercolor-couple-223-297.webp" alt="Портрет 5" width="223" height="297" loading="lazy">
                    </div>
					<div class="carousel-item snap-center">
                        <img src="https://muse.ooo/upload/img/watercolor-couple-223-297.webp" alt="Портрет 5" width="223" height="297" loading="lazy">
                    </div>
					<div class="carousel-item snap-center">
                        <img src="https://muse.ooo/upload/img/watercolor-couple-223-297.webp" alt="Портрет 5" width="223" height="297" loading="lazy">
                    </div>
					<div class="carousel-item snap-center">
                        <img src="https://muse.ooo/upload/img/watercolor-couple-223-297.webp" alt="Портрет 5" width="223" height="297" loading="lazy">
                    </div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2 class="text-2xl">Решение 2: CSS-only с нативным scroll</h2>
            <p><strong>Ограничение:</strong> CSS scroll-snap не поддерживает горизонтальную прокрутку колесиком мыши на ПК. Работает на мобильных (touch) и с горизонтальным скроллбаром (теперь виден внизу).</p>
            
            <div class="carousel-scroll-v2 pb-4" style="overflow-x: auto; scroll-behavior: smooth; scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch;">
                <div class="flex gap-4 px-4" style="min-width: max-content;">
                    <div class="carousel-item snap-center">
                        <img src="https://muse.ooo/upload/img/watercolor-couple-223-297.webp" alt="Портрет 1" width="223" height="297" loading="lazy">
                    </div>
                    <div class="carousel-item snap-center">
                        <img src="https://muse.ooo/upload/img/watercolor-couple-223-297.webp" alt="Портрет 2" width="223" height="297" loading="lazy">
                    </div>
                    <div class="carousel-item snap-center">
                        <img src="https://muse.ooo/upload/img/watercolor-couple-223-297.webp" alt="Портрет 3" width="223" height="297" loading="lazy">
                    </div>
                    <div class="carousel-item snap-center">
                        <img src="https://muse.ooo/upload/img/watercolor-couple-223-297.webp" alt="Портрет 4" width="223" height="297" loading="lazy">
                    </div>
                    <div class="carousel-item snap-center">
                        <img src="https://muse.ooo/upload/img/watercolor-couple-223-297.webp" alt="Портрет 5" width="223" height="297" loading="lazy">
                    </div>
					<div class="carousel-item snap-center">
                        <img src="https://muse.ooo/upload/img/watercolor-couple-223-297.webp" alt="Портрет 5" width="223" height="297" loading="lazy">
                    </div>
					<div class="carousel-item snap-center">
                        <img src="https://muse.ooo/upload/img/watercolor-couple-223-297.webp" alt="Портрет 5" width="223" height="297" loading="lazy">
                    </div>
					<div class="carousel-item snap-center">
                        <img src="https://muse.ooo/upload/img/watercolor-couple-223-297.webp" alt="Портрет 5" width="223" height="297" loading="lazy">
                    </div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2 class="text-2xl">Решение 3: Упрощенное JS (без drag, только wheel)</h2>
            <p>Минимальный JavaScript только для обработки wheel события, без drag-to-scroll</p>
            
            <div class="carousel-scroll-v3 scrollbar-hide pb-4" style="overflow-x: auto; scroll-behavior: smooth; scroll-snap-type: x mandatory;">
                <div class="flex gap-4 px-4" style="min-width: max-content;">
                    <div class="carousel-item snap-center">
                        <img src="https://muse.ooo/upload/img/watercolor-couple-223-297.webp" alt="Портрет 1" width="223" height="297" loading="lazy">
                    </div>
                    <div class="carousel-item snap-center">
                        <img src="https://muse.ooo/upload/img/watercolor-couple-223-297.webp" alt="Портрет 2" width="223" height="297" loading="lazy">
                    </div>
                    <div class="carousel-item snap-center">
                        <img src="https://muse.ooo/upload/img/watercolor-couple-223-297.webp" alt="Портрет 3" width="223" height="297" loading="lazy">
                    </div>
                    <div class="carousel-item snap-center">
                        <img src="https://muse.ooo/upload/img/watercolor-couple-223-297.webp" alt="Портрет 4" width="223" height="297" loading="lazy">
                    </div>
                    <div class="carousel-item snap-center">
                        <img src="https://muse.ooo/upload/img/watercolor-couple-223-297.webp" alt="Портрет 5" width="223" height="297" loading="lazy">
                    </div>
					<div class="carousel-item snap-center">
                        <img src="https://muse.ooo/upload/img/watercolor-couple-223-297.webp" alt="Портрет 5" width="223" height="297" loading="lazy">
                    </div>
					<div class="carousel-item snap-center">
                        <img src="https://muse.ooo/upload/img/watercolor-couple-223-297.webp" alt="Портрет 5" width="223" height="297" loading="lazy">
                    </div>
					<div class="carousel-item snap-center">
                        <img src="https://muse.ooo/upload/img/watercolor-couple-223-297.webp" alt="Портрет 5" width="223" height="297" loading="lazy">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Решение 1: Оптимизированное (без forced reflows)
        (function() {
            const carousels = document.querySelectorAll('.carousel-scroll-v1');
            
            carousels.forEach(carousel => {
                // Используем Intersection Observer для определения, когда карусель в viewport
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (!entry.isIntersecting) {
                            carousel.dataset.active = 'false';
                        } else {
                            carousel.dataset.active = 'true';
                        }
                    });
                }, { threshold: 0.1 });
                observer.observe(carousel);

                // Wheel обработчик - используем scrollBy, избегаем чтения геометрии
                carousel.addEventListener('wheel', (e) => {
                    if (window.innerWidth < 1024 || carousel.dataset.active !== 'true') return;
                    
                    const rect = carousel.getBoundingClientRect();
                    const isOverCarousel = e.clientX >= rect.left && e.clientX <= rect.right &&
                                         e.clientY >= rect.top && e.clientY <= rect.bottom;
                    
                    if (isOverCarousel && Math.abs(e.deltaX) < Math.abs(e.deltaY)) {
                        e.preventDefault();
                        // Используем scrollBy - нативный метод, оптимизирован браузером
                        carousel.scrollBy({
                            left: e.deltaY * 0.6,
                            behavior: 'auto'
                        });
                    }
                }, { passive: false });

                // Drag-to-scroll для ПК
                let isDown = false;
                let startX = 0;
                let startScrollLeft = 0;
                
                carousel.style.cursor = 'grab';
                
                carousel.addEventListener('mousedown', (e) => {
                    if (window.innerWidth < 1024) return;
                    isDown = true;
                    carousel.style.cursor = 'grabbing';
                    startX = e.pageX;
                    startScrollLeft = carousel.scrollLeft;
                    e.preventDefault();
                });

                carousel.addEventListener('mousemove', (e) => {
                    if (!isDown || window.innerWidth < 1024) return;
                    e.preventDefault();
                    const walk = (e.pageX - startX) * 1.2;
                    carousel.scrollLeft = startScrollLeft - walk;
                });

                carousel.addEventListener('mouseleave', () => {
                    if (isDown) {
                        isDown = false;
                        carousel.style.cursor = 'grab';
                    }
                });

                carousel.addEventListener('mouseup', () => {
                    if (isDown) {
                        isDown = false;
                        carousel.style.cursor = 'grab';
                    }
                });
            });
        })();

        // Решение 3: Упрощенное (только wheel, без drag)
        (function() {
            const carousels = document.querySelectorAll('.carousel-scroll-v3');
            
            carousels.forEach(carousel => {
                let isWheeling = false;
                
                carousel.addEventListener('wheel', (e) => {
                    if (window.innerWidth < 1024) return;
                    
                    // Используем event.target.closest для проверки без getBoundingClientRect
                    if (!carousel.contains(e.target)) return;
                    
                    if (Math.abs(e.deltaX) < Math.abs(e.deltaY)) {
                        e.preventDefault();
                        isWheeling = true;
                        
                        // Простой scrollBy - нативный метод браузера, минимум reflows
                        carousel.scrollBy({
                            left: e.deltaY * 0.6,
                            behavior: 'auto'
                        });
                        
                        clearTimeout(carousel.wheelTimeout);
                        carousel.wheelTimeout = setTimeout(() => {
                            isWheeling = false;
                        }, 150);
                    }
                }, { passive: false });
            });
        })();
    </script>
</body>
</html>

