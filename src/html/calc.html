<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор печати на холсте</title>
    <link rel="stylesheet" href="css/output.css?v=2">
</head>
<body>

    <main>

    <section id="calc" data-calc-root class="container lg:py-8">
        <h2 class="heading-section text-center mb-8">Цена</h2>

        <div class="relative">
            
            <div id="calc-main-layout" class="flex flex-col lg:grid lg:grid-cols-[1fr_auto] items-stretch lg:items-start relative lg:gap-8">
                <div class="w-full">
                    <div id="uploader-zone" class="uploader-zone mb-2 lg:mb-4">
                        <div class="w-full max-w-sm mx-auto lg:max-w-none">
                            <input type="file" id="file-upload" class="hidden" accept="image/jpeg,image/png,image/gif,image/webp" multiple>
                            <button id="btn-upload-empty" class="w-full bg-primary hover:bg-primary-hover text-white font-bold py-3 rounded-lg text-sm uppercase tracking-wide transition-all active:scale-[0.98] flex items-center justify-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M12 12v9"/><path d="m16 16-4-4-4 4"/></svg>
                                <span>Загрузить фото</span>
                            </button>
                            <div id="uploader-thumbnails" class="uploader-thumbnails thin-scrollbar-x" role="listbox" aria-label="Загруженные фотографии"></div>
                            <div id="uploader-alert" class="uploader-alert" role="status" aria-live="polite"></div>
                            <div id="uploader-status" class="sr-only" role="status" aria-live="polite" aria-atomic="true"></div>
                        </div>
                    </div>
                    <div id="calc-preview-column" class="w-full bg-secondary shadow-xl lg:shadow-none lg:bg-transparent z-40 transition-all">
                        <div class="relative w-full overflow-hidden lg:rounded-2xl lg:shadow-xl lg:border lg:border-slate-200">
                            <div class="relative room-bg" id="room-container">
                                <div id="visualizer-container" class="absolute inset-0 w-full h-full pointer-events-none">
                                    <div id="preview-canvas" class="calc-preview-canvas bg-white transition-transform pointer-events-auto">
                                         <div class="absolute -top-12 left-1/2 -translate-x-1/2 flex gap-1 pointer-events-none">
                                             <div class="dim-badge"><span id="lbl-w">20</span> см</div>
                                         </div>
                                         <div class="absolute top-1/2 -left-16 -translate-y-1/2 flex gap-1 pointer-events-none">
                                             <div class="dim-badge -rotate-90 origin-center"><span id="lbl-h">30</span> см</div>
                                         </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="calc-panel lg:row-span-2 lg:sticky lg:top-4 lg:self-start">
                    <div class="p-4 lg:p-6 space-y-6 lg:space-y-8">
                        <section id="size-section">
                            <div class="section-title"><span>Размер, см</span></div>
                            <div id="size-inputs-row" class="hidden lg:flex items-center gap-2 mb-3">
                                <input type="number" id="inp-w" value="20" enterkeyhint="next" autocomplete="off" inputmode="numeric" class="w-full h-10 lg:h-12 text-center border border-slate-200 rounded-lg text-base lg:text-lg font-bold text-dark focus-visible:border-transparent focus-visible:outline-2 focus-visible:-outline-offset-2 focus-visible:outline-primary outline-none transition" placeholder="Ш">
                                <span class="text-slate-300">✕</span>
                                <input type="number" id="inp-h" value="30" enterkeyhint="done" autocomplete="off" inputmode="numeric" class="w-full h-10 lg:h-12 text-center border border-slate-200 rounded-lg text-base lg:text-lg font-bold text-dark focus-visible:border-transparent focus-visible:outline-2 focus-visible:-outline-offset-2 focus-visible:outline-primary outline-none transition" placeholder="В">
                            </div>
                            <div class="flex lg:hidden gap-2 overflow-x-auto pb-1 thin-scrollbar-x" id="size-presets-grid"></div>
                            <div id="size-extra-carousel" class="hidden lg:block mt-3">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-[10px] font-bold uppercase tracking-widest text-slate-500">Размеры</span>
                                </div>
                                <div id="size-extra-presets-track" class="flex gap-2 overflow-x-auto pb-1 scroll-smooth"></div>
                            </div>
                        </section>
                        <section>
                            <div class="section-title"><span>Печать и подрамник</span><span id="badge-wrap" class="text-sm font-bold text-slate-500 normal-case">0 р.</span></div>
                            <div class="flex p-1 bg-secondary rounded-lg">
                                <button class="wrap-btn flex-1 py-2 rounded-md text-xs font-medium transition bg-white text-dark shadow-sm" data-val="STANDARD">Стандартный</button>
                                <button class="wrap-btn flex-1 py-2 rounded-md text-xs font-medium transition text-body" data-val="GALLERY">Толстый</button>
                                <button class="wrap-btn flex-1 py-2 rounded-md text-xs font-medium transition text-body" data-val="NO_FRAME">Рулон</button>
                            </div>
                        </section>
                        <section>
                            <div class="section-title"><span>Обработка фото</span><span id="badge-processing" class="text-sm font-bold text-slate-500 normal-case">0 р.</span></div>
                            <div class="grid grid-cols-1">
                                <select id="processing-select" aria-label="Обработка фото" class="col-start-1 row-start-1 w-full appearance-none bg-white border border-slate-200 text-body py-3 pl-4 pr-8 rounded-lg text-sm font-medium focus-visible:border-transparent focus-visible:outline-2 focus-visible:-outline-offset-2 focus-visible:outline-primary">
                                    <option value="0">Базовая</option>
                                    <option value="300">Оптимальная (+300 р.)</option>
                                    <option value="900">Премиальная (+900 р.)</option>
                                </select>
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="pointer-events-none col-start-1 row-start-1 mr-2 w-5 h-5 self-center justify-self-end text-slate-500"><path d="m6 9 6 6 6-6"/></svg>
                            </div>
                        </section>
                        <section>
                            <div class="section-title"><span>Оформление в багет</span><span class="text-sm text-slate-500 font-bold normal-case" id="price-frame">0 р.</span></div>
                            <div id="frame-section" class="border border-slate-200 rounded-lg p-4 flex items-center gap-4 cursor-pointer hover:border-primary transition group bg-white">
                                <div class="w-10 h-10 bg-slate-50 rounded border border-slate-200 flex items-center justify-center text-slate-300"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg></div>
                                <div>
                                    <div class="text-sm font-bold text-body" id="selected-frame-text">Без багета</div>
                                    <div class="text-xs text-primary font-medium group-hover:underline">Выбрать из каталога →</div>
                                </div>
                            </div>
                        </section>
                        <section class="space-y-6">
                            <div class="bg-white">
                                <div class="section-title mb-2"><span>Покрытие лаком</span><span class="text-sm font-bold text-slate-500 normal-case" id="price-varnish">0 р.</span></div>
                                <div class="flex gap-3">
                                    <div class="flex h-6 shrink-0 items-center">
                                        <div class="group grid size-4 grid-cols-1">
                                            <input id="toggle-varnish" type="checkbox" name="varnish" checked aria-describedby="varnish-description" class="calc-checkbox col-start-1 row-start-1 forced-colors:appearance-auto" />
                                            <svg viewBox="0 0 14 14" fill="none" class="pointer-events-none col-start-1 row-start-1 size-3.5 self-center justify-self-center stroke-white">
                                                <path d="M3 8L6 11L11 3.5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-0 group-has-checked:opacity-100" />
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="text-sm/6">
                                        <label for="toggle-varnish" class="font-medium text-body cursor-pointer">Защитит от влаги и выцветания</label>
                                    </div>
                                </div>
                            </div>
                            <div class="h-px bg-secondary"></div>
                            <div class="bg-white">
                                <div class="section-title mb-2"><span>Подарочная упаковка</span><span class="text-sm font-bold text-slate-500 normal-case" id="price-gift">0 р.</span></div>
                                <div class="flex gap-3">
                                    <div class="flex h-6 shrink-0 items-center">
                                        <div class="group grid size-4 grid-cols-1">
                                            <input id="toggle-gift" type="checkbox" name="gift" aria-describedby="gift-description" class="calc-checkbox col-start-1 row-start-1 forced-colors:appearance-auto" />
                                            <svg viewBox="0 0 14 14" fill="none" class="pointer-events-none col-start-1 row-start-1 size-3.5 self-center justify-self-center stroke-white">
                                                <path d="M3 8L6 11L11 3.5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-0 group-has-checked:opacity-100" />
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="text-sm/6">
                                        <label for="toggle-gift" class="font-medium text-body cursor-pointer">Крафт-бумага, лента и открытка</label>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                    <div class="hidden lg:block p-6 border-t border-slate-100 bg-white lg:rounded-b-2xl">
                        <div class="flex justify-between items-end">
                            <div class="flex items-center gap-2">
                                <span class="section-title mb-0">Итого</span>
                                <span id="discount-badge" class="inline-flex items-center rounded-md bg-primary px-2.5 py-1 text-sm font-bold text-white leading-none" style="display:none">-20%</span>
                            </div>
                            <div class="flex flex-col items-end">
                                <div class="text-base font-bold text-slate-400 line-through decoration-slate-400 decoration-1 mb-0.5"><span id="old-price">1 500</span> р.</div>
                                <div class="text-2xl font-bold text-primary leading-none"><span id="total-price">890</span> <span>р.</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <form id="order-form-container" class="calc-order-form w-full lg:col-start-1 lg:row-start-2" novalidate>
                    <h3 class="text-xl font-bold text-body text-center lg:text-left mb-6">Оформление заказа</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div><input type="text" id="client-name" name="client_name_x" class="form-input" placeholder="Имя*" autocomplete="name"></div>
                        <div><input type="tel" id="client-phone" name="client_phone_x" class="form-input" placeholder="Телефон*" autocomplete="tel"></div>
                        <div><input type="email" id="client-email" name="client_email_x" class="form-input" placeholder="E-mail" autocomplete="email"></div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div><textarea id="client-link" name="client_link_x" class="form-input h-full resize-none" rows="4" placeholder="Поле для ссылки на фото или облако"></textarea></div>
                        <div><textarea id="client-comment" name="client_comment_x" class="form-input h-full resize-none" rows="4" placeholder="Комментарий"></textarea></div>
                    </div>
                    <div class="flex flex-col md:flex-row items-center justify-between gap-6 border-t border-slate-100 pt-6">
                        <div class="text-xs text-slate-500 text-left">Заполняя форму, я соглашаюсь с условиями <a href="https://muse.ooo/info/oferta/" class="underline hover:text-primary">Оферты</a> и даю свое согласие на обработку персональных данных в соответствии с <a href="https://muse.ooo/info/politika_konfidentsialnosti_sayta/" class="underline hover:text-primary">Политикой конфиденциальности сайта</a></div>
                        <button type="button" id="btn-submit-order" class="hidden lg:block w-full md:w-auto btn-header-cta px-10 py-4 active:scale-[0.98]">Заказать</button>
                    </div>
                </form>
            </div>

            <div id="mobile-sticky-bar" class="calc-sticky-bar">
                <div class="flex items-center gap-1.5 min-w-0">
                    <div class="text-lg font-bold text-primary whitespace-nowrap" id="sticky-total-price">9 543 р.</div>
                    <div class="text-xs font-bold text-slate-500 line-through decoration-slate-500 decoration-1 whitespace-nowrap" id="sticky-old-price">11 930 р.</div>
                    <span id="sticky-discount-badge" class="inline-flex items-center rounded-md bg-primary px-2 py-0.5 text-xs font-bold text-white leading-none shrink-0" style="display:none">-20%</span>
                </div>
                <button id="btn-sticky-order" class="btn-header-cta px-5 py-2.5 active:scale-[0.98] text-sm shrink-0">Заказать</button>
            </div>

        </div>

    </section>

    <dialog id="frame-modal" class="modal-shell">
        <div class="calc-frame-modal-content" id="frame-modal-content">
            <div class="calc-frame-modal-header">
                <h3 class="text-xl font-bold text-body">Каталог багета</h3>
                <button id="close-frame-modal" type="button" class="p-2 text-gray-400 hover:text-black transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                </button>
            </div>
            <div class="calc-frame-modal-body custom-scrollbar">
                <div id="frame-upload-cta" class="calc-frame-upload-cta">
                    <p class="text-xs text-slate-500 mb-3">Загрузите фото для примерки багета</p>
                    <button id="modal-upload-btn" type="button" class="bg-white border border-gray-200 text-body hover:border-primary hover:text-primary font-bold py-2 px-4 rounded-lg text-xs uppercase tracking-widest transition flex items-center justify-center gap-2 mx-auto">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4"><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M12 12v9"/><path d="m16 16-4-4-4 4"/></svg>
                        <span>Загрузить фото</span>
                    </button>
                </div>
                <div class="mb-8">
                    <div class="section-title mb-4 px-1">Студийный багет (Минимализм)</div>
                    <div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-4" id="frames-grid-studio"></div>
                </div>
                <div>
                    <div class="section-title mb-4 px-1">Классический багет (Дерево, Золото)</div>
                    <div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-4" id="frames-grid-classic"></div>
                </div>
            </div>
            <div class="calc-frame-modal-footer">
                 <button id="cancel-frame-selection" type="button" class="px-6 py-3 rounded-lg text-xs font-bold uppercase tracking-widest text-body hover:bg-gray-100 transition">Отмена</button>
                <button id="apply-frame-selection" type="button" class="btn-header-cta px-8 py-3 active:scale-[0.98]">Выбрать этот багет</button>
            </div>
        </div>
    </dialog>
    
    <dialog id="lightbox" class="modal-shell bg-white/95 backdrop-blur-sm">
        <div class="absolute top-4 right-4 z-10">
             <button id="lightbox-close" class="calc-lightbox-close p-2 text-gray-400 hover:text-black transition pointer-events-auto">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            </button>
        </div>
        <div id="lightbox-content" class="relative transition-transform duration-300"></div>
    </dialog>

    </main>

    <script src="js/nav.js" defer></script>
    <script src="js/uploader.js" defer></script>
        <script src="js/calc.js?v=2" defer></script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                var calcRoot = document.querySelector('[data-calc-root]');
                if (!calcRoot) return;

                function startCalc() {
                    if (window.__MUSE_CALC_BOOTED__) return;
                    window.__MUSE_CALC_BOOTED__ = true;
                    CalcInit({ type: 'canvas', showProcessing: true, showUpload: true });
                }

                if (!('IntersectionObserver' in window)) {
                    startCalc();
                    return;
                }

                var observer = new IntersectionObserver(function (entries) {
                    if (entries.some(function (entry) { return entry.isIntersecting; })) {
                        observer.disconnect();
                        if ('requestIdleCallback' in window) {
                            requestIdleCallback(startCalc, { timeout: 800 });
                        } else {
                            setTimeout(startCalc, 0);
                        }
                    }
                }, { rootMargin: '300px 0px' });

                observer.observe(calcRoot);
            });
        </script>
</body>
</html>