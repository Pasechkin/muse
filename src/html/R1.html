<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Muse ‚Äî –ø–æ–∏—Å–∫ —Ä–µ–ø—Ä–æ–¥—É–∫—Ü–∏–π</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial, sans-serif; padding:20px; background:#fafafa }
input { padding:10px; width:280px }
button { padding:10px }
.results {
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:20px;
  margin-top:20px;
}
.card { background:#fff; border-radius:6px; box-shadow:0 2px 8px rgba(0,0,0,.1) }
.card img { width:100% }
.info { padding:10px }
.title { font-weight:bold }
.artist { color:#555 }
/* –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–∏ —Å—Ç–∏–ª–∏ –≤ <style> */
.card img {
  height: 200px;
  width: 100%;
  object-fit: contain;
  background: linear-gradient(45deg, #f5f5f5 25%, #e0e0e0 25%, #e0e0e0 50%, #f5f5f5 50%, #f5f5f5 75%, #e0e0e0 75%);
  background-size: 20px 20px;
}

.title, .artist {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* –ö–Ω–æ–ø–∫–∞ –ø–æ–∏—Å–∫–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
button:hover {
  background: #0056b3;
  cursor: pointer;
}

/* –ü–æ–ª–µ –≤–≤–æ–¥–∞ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ */
input:focus {
  outline: none;
  border-color: #007bff;
  box-shadow: 0 0 0 2px rgba(0,123,255,.25);
}
/* –í—Å—Ç–∞–≤—å—Ç–µ –≤ <style> */
.card {
  transition: transform 0.2s, box-shadow 0.2s;
  background: white;
}

.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.card img {
  transition: opacity 0.3s;
}

.card:hover img {
  opacity: 0.9;
}

/* –§–∏–ª—å—Ç—Ä—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ */
.filters {
  margin: 15px 0;
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.filter-btn {
  padding: 5px 12px;
  background: #f0f0f0;
  border: 1px solid #ddd;
  border-radius: 15px;
  cursor: pointer;
  font-size: 14px;
}

.filter-btn.active {
  background: #007bff;
  color: white;
  border-color: #007bff;
}
</style>
</head>
<body>

<h2>–ü–æ–∏—Å–∫ —Ä–µ–ø—Ä–æ–¥—É–∫—Ü–∏–π</h2>
<input id="query" placeholder="Van Gogh / Starry Night">
<button onclick="search()">–ù–∞–π—Ç–∏</button>

<div id="results" class="results"></div>

<script>
async function searchArtworks() {
  const q = document.getElementById('query').value.trim();
  if (!q) return;

  const results = document.getElementById('results');
  results.innerHTML = '<div style="text-align:center;padding:20px;">üé® –ò—â—É –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∏—Å–∫—É—Å—Å—Ç–≤–∞...</div>';

  // –°–¢–†–ê–¢–ï–ì–ò–Ø 1: –ò—Å–∫–∞—Ç—å –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö "paintings by" –∏ "artworks by"
  // –≠—Ç–æ –¥–∞—Å—Ç –∏–º–µ–Ω–Ω–æ —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
  
  const searchQuery = 
    `"${q}"` + // –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è
    ` (category:paintings OR category:artworks)` +
    ` filetype:jpg|jpeg|png`;
  
  const url =
    'https://commons.wikimedia.org/w/api.php' +
    '?action=query' +
    '&generator=search' +
    '&gsrsearch=' + encodeURIComponent(searchQuery) +
    '&gsrnamespace=6' +
    '&gsrlimit=50' + // –ë–æ–ª—å—à–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
    '&prop=imageinfo|categories' + // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    '&iiprop=url|extmetadata|mime|size' + // –ò —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
    '&clprop=sortkey' +
    '&cllimit=10' +
    '&iiurlwidth=800' + // –ë–æ–ª—å—à–µ —à–∏—Ä–∏–Ω–∞ –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–∞
    '&format=json' +
    '&origin=*';

  try {
    const res = await fetch(url);
    const data = await res.json();

    results.innerHTML = '';
    
    if (!data.query || !data.query.pages) {
      results.innerHTML = '–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–π –∏—Å–∫—É—Å—Å—Ç–≤–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ';
      return;
    }

    const pages = Object.values(data.query.pages);
    let foundArtworks = 0;
    
    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Ä–∞–∑–º–µ—Ä—É —Ñ–∞–π–ª–∞ - –±–æ–ª—å—à–∏–µ –æ–±—ã—á–Ω–æ –ª—É—á—à–µ
    pages.sort((a, b) => {
      const sizeA = a.imageinfo?.[0]?.size || 0;
      const sizeB = b.imageinfo?.[0]?.size || 0;
      return sizeB - sizeA; // –ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã –ø–µ—Ä–≤—ã–º–∏
    });
    
    pages.forEach(page => {
      const img = page.imageinfo?.[0];
      if (!img?.url) return;
      
      // –§–ò–õ–¨–¢–† 1: –¢–æ–ª—å–∫–æ –±–æ–ª—å—à–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–±–æ–ª—å—à–µ 100KB)
      if (img.size && img.size < 100000) { // –º–µ–Ω—å—à–µ 100KB
        return; // –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –º–∞–ª–µ–Ω—å–∫–∏–µ –ø—Ä–µ–≤—å—é
      }
      
      // –§–ò–õ–¨–¢–† 2: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
      if (img.width && img.height) {
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–µ –∏–ª–∏ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ (–≤–æ–∑–º–æ–∂–Ω–æ, –∏–∫–æ–Ω–∫–∏)
        if (img.width < 800 && img.height < 600) return;
      }
      
      // –§–ò–õ–¨–¢–† 3: –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ñ–∞–π–ª–∞
      const fileName = page.title.toLowerCase();
      
      // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —è–≤–Ω–æ –Ω–µ —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
      const skipWords = [
        'frame', 'framed', 'museum', 'gallery', 'exhibition',
        'photo', 'photograph', 'scan', 'cropped', 'thumb',
        'icon', 'logo', 'signature', 'stamp', 'poster',
        'sketch', 'study', 'preparatory'
      ];
      
      if (skipWords.some(word => fileName.includes(word))) {
        return;
      }
      
      // –§–ò–õ–¨–¢–† 4: –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
      const meta = img.extmetadata || {};
      const description = (meta.ImageDescription?.value || '').toLowerCase();
      const categories = (meta.Categories?.value || '').toLowerCase();
      
      // –ò—â–µ–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞, —É–∫–∞–∑—ã–≤–∞—é—â–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∏—Å–∫—É—Å—Å—Ç–≤–∞
      const artKeywords = [
        'painting', 'oil on canvas', 'watercolor', 'drawing',
        'artwork', 'masterpiece', 'canvas', 'painter',
        '—Ö–æ–ª—Å—Ç', '–º–∞—Å–ª–æ', '–∞–∫–≤–∞—Ä–µ–ª—å', '—Ä–∏—Å—É–Ω–æ–∫', '–∫–∞—Ä—Ç–∏–Ω–∞'
      ];
      
      const isLikelyArtwork = 
        artKeywords.some(keyword => 
          description.includes(keyword) || 
          categories.includes(keyword) ||
          fileName.includes(keyword)
        );
      
      if (!isLikelyArtwork && foundArtworks > 0) {
        // –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å —Ö–æ—Ä–æ—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–æ–º–Ω–∏—Ç–µ–ª—å–Ω—ã–µ
        return;
      }
      
      foundArtworks++;
      
      // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
      const title = meta.ObjectName?.value || 
                   page.title
                     .replace('File:', '')
                     .replace(/\.[^/.]+$/, '')
                     .replace(/_/g, ' ');
      
      const artist = meta.Artist?.value || 
                    meta.Creator?.value || 
                    '–•—É–¥–æ–∂–Ω–∏–∫ –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω';
      
      const date = meta.Date?.value || meta.CreationDate?.value || '';
      const medium = meta.Medium?.value || '';
      const license = meta.LicenseShortName?.value || '';
      
      const dimensions = img.width && img.height 
        ? `${img.width}√ó${img.height} px` 
        : '';
      
      const card = document.createElement('div');
      card.className = 'card';
      card.style.cursor = 'pointer';
      
      card.innerHTML = `
        <div style="position:relative;">
          <img src="${img.url}" 
               loading="lazy" 
               alt="${title}"
               style="height:250px;object-fit:contain;">
          ${dimensions ? `<div style="position:absolute;bottom:5px;right:5px;background:rgba(0,0,0,0.7);color:white;padding:2px 5px;border-radius:3px;font-size:11px;">${dimensions}</div>` : ''}
        </div>
        <div class="info">
          <div class="title" title="${title}">
            ${title.length > 35 ? title.substring(0, 35) + '...' : title}
          </div>
          <div class="artist">${artist.length > 25 ? artist.substring(0, 25) + '...' : artist}</div>
          <div style="display:flex;justify-content:space-between;margin-top:5px;">
            <span class="license">${license}</span>
            ${date ? `<span style="font-size:12px;color:#666;">${date.substring(0,4)}</span>` : ''}
          </div>
          ${medium ? `<div style="font-size:11px;color:#888;margin-top:3px;">${medium.substring(0,30)}</div>` : ''}
        </div>
      `;
      
      // –û—Ç–∫—Ä—ã—Ç—å –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ –ø—Ä–∏ –∫–ª–∏–∫–µ
      card.onclick = () => {
        window.open(`https://commons.wikimedia.org/wiki/${encodeURIComponent(page.title)}`, '_blank');
      };
      
      results.appendChild(card);
      
      // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–∞
      if (foundArtworks >= 15) {
        return;
      }
    });
    
    if (foundArtworks === 0) {
      // –ü–æ–ø—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫
      tryAlternativeSearch(q);
    } else {
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
      const hint = document.createElement('div');
      hint.style.cssText = 'margin-top:20px;padding:15px;background:#f0f8ff;border-radius:5px;font-size:14px;color:#555;';
      hint.innerHTML = `
        <strong>üéØ –°–æ–≤–µ—Ç—ã –¥–ª—è –ª—É—á—à–µ–≥–æ –ø–æ–∏—Å–∫–∞:</strong><br>
        ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è: "Ilya Repin", "Aivazovsky"<br>
        ‚Ä¢ –î–æ–±–∞–≤—å—Ç–µ "painting": "Repin painting", "Barge Haulers"<br>
        ‚Ä¢ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ç–æ—á–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ: "The Ninth Wave", "Bogatyrs"
      `;
      results.appendChild(hint);
    }
    
  } catch (e) {
    console.error(e);
    results.innerHTML = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
  }
}

// –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
async function tryAlternativeSearch(query) {
  const results = document.getElementById('results');
  
  // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ–∏—Å–∫–∞
  const searchVariants = [
    `${query} painting`,  // –∞–Ω–≥–ª
    `${query} –∫–∞—Ä—Ç–∏–Ω–∞`,   // —Ä—É—Å
    `"${query}" artwork`,
    `"${query}" oil on canvas`
  ];
  
  for (const variant of searchVariants) {
    const url = `https://commons.wikimedia.org/w/api.php?action=query&generator=search&gsrsearch=${encodeURIComponent(variant)}&gsrnamespace=6&gsrlimit=10&prop=imageinfo&iiprop=url|extmetadata&format=json&origin=*`;
    
    const res = await fetch(url);
    const data = await res.json();
    
    if (data.query?.pages) {
      const pages = Object.values(data.query.pages);
      if (pages.length > 0) {
        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        break;
      }
    }
  }
}

// –ó–∞–º–µ–Ω–∏—Ç—å –≤—ã–∑–æ–≤ search() –Ω–∞ searchArtworks()
// <button onclick="searchArtworks()">–ù–∞–π—Ç–∏</button>
</script>

</body>
</html>

