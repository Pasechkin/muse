<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Muse ‚Äî –ø–æ–∏—Å–∫ —Ä–µ–ø—Ä–æ–¥—É–∫—Ü–∏–π</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial, sans-serif; padding:20px; background:#fafafa }
input { padding:10px; width:280px; font-size:16px; border:1px solid #ddd; border-radius:4px; }
button { padding:10px 15px; font-size:16px; background:#007bff; color:white; border:none; border-radius:4px; cursor:pointer; }
button:hover { background: #0056b3; }
input:focus { outline: none; border-color: #007bff; box-shadow: 0 0 0 2px rgba(0,123,255,.25); }

.results {
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:20px;
  margin-top:20px;
}
.card { 
  background:#fff; 
  border-radius:6px; 
  box-shadow:0 2px 8px rgba(0,0,0,.1);
  transition: transform 0.2s, box-shadow 0.2s;
  overflow:hidden;
  cursor: pointer;
}
.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}
.card img {
  width:100%;
  height:200px;
  object-fit: contain;
  background: linear-gradient(45deg, #f5f5f5 25%, #e0e0e0 25%, #e0e0e0 50%, #f5f5f5 50%, #f5f5f5 75%, #e0e0e0 75%);
  background-size: 20px 20px;
  transition: opacity 0.3s;
}
.card:hover img { opacity: 0.9; }

.info { padding:10px }
.title { 
  font-weight:bold;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  margin-bottom:5px;
}
.artist { 
  color:#555;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  margin-bottom:5px;
}
.license { font-size:12px; color:#888; }
</style>
</head>
<body>

<h2>–ü–æ–∏—Å–∫ —Ä–µ–ø—Ä–æ–¥—É–∫—Ü–∏–π</h2>
<input id="query" placeholder="Van Gogh / Starry Night">
<button onclick="search()">–ù–∞–π—Ç–∏</button>

<div id="results" class="results"></div>

<script>
// –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–∏—Å–∫ –ø–æ –Ω–∞–∂–∞—Ç–∏—é Enter
document.getElementById('query').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    search();
  }
});

async function search() {
  const q = document.getElementById('query').value.trim();
  if (!q) return;

  const results = document.getElementById('results');
  results.innerHTML = '<div style="text-align:center;padding:20px;">üé® –ò—â—É –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∏—Å–∫—É—Å—Å—Ç–≤–∞...</div>';

  // –£–ü–†–û–©–ï–ù–ù–´–ô –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å - —É–±–∏—Ä–∞–µ–º —Å–ª–æ–∂–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
  const searchQuery = q + ' painting';
  
  const url =
    'https://commons.wikimedia.org/w/api.php' +
    '?action=query' +
    '&generator=search' +
    '&gsrsearch=' + encodeURIComponent(searchQuery) +
    '&gsrnamespace=6' +
    '&gsrlimit=50' +
    '&prop=imageinfo' +
    '&iiprop=url|extmetadata|mime|size|dimensions' +
    '&iiurlwidth=600' +
    '&format=json' +
    '&origin=*';

  try {
    const res = await fetch(url);
    const data = await res.json();

    results.innerHTML = '';
    
    if (!data.query || !data.query.pages) {
      results.innerHTML = '<div style="text-align:center;padding:40px;color:#666;">–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–π –∏—Å–∫—É—Å—Å—Ç–≤–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
      return;
    }

    const pages = Object.values(data.query.pages);
    let foundArtworks = 0;
    
    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Ä–∞–∑–º–µ—Ä—É —Ñ–∞–π–ª–∞ - –±–æ–ª—å—à–∏–µ –æ–±—ã—á–Ω–æ –ª—É—á—à–µ
    pages.sort((a, b) => {
      const sizeA = a.imageinfo?.[0]?.size || 0;
      const sizeB = b.imageinfo?.[0]?.size || 0;
      return sizeB - sizeA; // –ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã –ø–µ—Ä–≤—ã–º–∏
    });
    
    pages.forEach(page => {
      const img = page.imageinfo?.[0];
      if (!img?.url) return;
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
      if (img.mime && !img.mime.startsWith('image/')) {
        return;
      }
      
      // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–µ
      if (img.size && img.size < 50000) {
        return;
      }
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ñ–∞–π–ª–∞
      const fileName = page.title.toLowerCase();
      const badExtensions = ['.svg', '.pdf', '.ogg', '.webm'];
      if (badExtensions.some(ext => fileName.endsWith(ext))) {
        return;
      }
      
      foundArtworks++;
      
      const meta = img.extmetadata || {};
      const title = meta.ObjectName?.value || 
                   page.title
                     .replace('File:', '')
                     .replace(/\.[^/.]+$/, '')
                     .replace(/_/g, ' ');
      
      const artist = meta.Artist?.value || 
                    meta.Creator?.value || 
                    '–•—É–¥–æ–∂–Ω–∏–∫ –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω';
      
      const date = meta.Date?.value || meta.CreationDate?.value || '';
      const license = meta.LicenseShortName?.value || '';
      
      const card = document.createElement('div');
      card.className = 'card';
      
      card.innerHTML = `
        <img src="${img.url}" 
             loading="lazy" 
             alt="${title}"
             onerror="this.onerror=null; this.src='data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><rect width=\"100\" height=\"100\" fill=\"%23f0f0f0\"/><text x=\"50\" y=\"50\" font-family=\"Arial\" font-size=\"14\" text-anchor=\"middle\" fill=\"%23999\">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</text></svg>'">
        <div class="info">
          <div class="title" title="${title}">
            ${title.length > 30 ? title.substring(0, 30) + '...' : title}
          </div>
          <div class="artist" title="${artist}">
            ${artist.length > 25 ? artist.substring(0, 25) + '...' : artist}
          </div>
          <div style="display:flex;justify-content:space-between;margin-top:5px;">
            <span class="license">${license}</span>
            ${date ? `<span style="font-size:12px;color:#666;">${date.substring(0,4)}</span>` : ''}
          </div>
        </div>
      `;
      
      card.onclick = () => {
        window.open(`https://commons.wikimedia.org/wiki/${encodeURIComponent(page.title)}`, '_blank');
      };
      
      results.appendChild(card);
      
      // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
      if (foundArtworks >= 20) {
        return;
      }
    });
    
    if (foundArtworks === 0) {
      results.innerHTML = `
        <div style="text-align:center;padding:40px;color:#666;">
          <div style="font-size:48px;margin-bottom:20px;">üé®</div>
          <h3>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
          <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:</p>
          <ul style="text-align:left;display:inline-block;margin-top:10px;">
            <li>"Van Gogh"</li>
            <li>"Monet water lilies"</li>
            <li>"Rembrandt"</li>
            <li>"Leonardo da Vinci"</li>
          </ul>
        </div>
      `;
    }
    
  } catch (e) {
    console.error(e);
    results.innerHTML = '<div style="text-align:center;padding:20px;color:#d32f2f;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.</div>';
  }
}
</script>

</body>
</html>
