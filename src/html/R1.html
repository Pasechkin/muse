<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Muse — поиск репродукций</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial, sans-serif; padding:20px; background:#fafafa }
input { padding:10px; width:280px }
button { padding:10px }
.results {
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:20px;
  margin-top:20px;
}
.card { background:#fff; border-radius:6px; box-shadow:0 2px 8px rgba(0,0,0,.1) }
.card img { width:100% }
.info { padding:10px }
.title { font-weight:bold }
.artist { color:#555 }
</style>
</head>
<body>

<h2>Поиск репродукций</h2>
<input id="query" placeholder="Van Gogh / Starry Night">
<button onclick="search()">Найти</button>

<div id="results" class="results"></div>

<script>
async function search() {
  const q = document.getElementById('query').value.trim();
  if (!q) return;

  const results = document.getElementById('results');
  results.innerHTML = 'Загрузка...';

  // 1. Поиск файлов
  const searchUrl =
    'https://commons.wikimedia.org/w/api.php' +
    '?action=query' +
    '&list=search' +
    '&srsearch=' + encodeURIComponent(q) +
    '&srnamespace=6' +
    '&srlimit=10' +
    '&format=json' +
    '&origin=*';

  try {
    const res = await fetch(searchUrl);
    const data = await res.json();

    results.innerHTML = '';

    if (!data.query?.search?.length) {
      results.innerHTML = 'Ничего не найдено';
      return;
    }

    // 2. Получаем информацию по каждому файлу
    for (const item of data.query.search) {
      const title = item.title;

      const fileUrl =
        'https://commons.wikimedia.org/w/api.php' +
        '?action=query' +
        '&titles=' + encodeURIComponent(title) +
        '&prop=imageinfo' +
        '&iiprop=url|extmetadata' +
        '&format=json' +
        '&origin=*';

      const fileRes = await fetch(fileUrl);
      const fileData = await fileRes.json();

      const page = Object.values(fileData.query.pages)[0];
      const img = page.imageinfo?.[0];
      if (!img) continue;

      const meta = img.extmetadata || {};

      const artwork = meta.ObjectName?.value || title.replace('File:', '');
      const artist = meta.Artist?.value || 'Автор неизвестен';

      const card = document.createElement('div');
      card.className = 'card';

      card.innerHTML = `
        <img src="${img.url}">
        <div class="info">
          <div class="title">${artwork}</div>
          <div class="artist">${artist}</div>
        </div>
      `;

      results.appendChild(card);
    }

  } catch (e) {
    console.error(e);
    results.innerHTML = 'Ошибка загрузки';
  }
}
</script>

</body>
</html>

