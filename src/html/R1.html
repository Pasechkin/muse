<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Muse ‚Äî –ø–æ–∏—Å–∫ —Ä–µ–ø—Ä–æ–¥—É–∫—Ü–∏–π</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial, sans-serif; padding:20px; background:#fafafa }
input { padding:10px; width:280px }
button { padding:10px }
.results {
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:20px;
  margin-top:20px;
}
.card { background:#fff; border-radius:6px; box-shadow:0 2px 8px rgba(0,0,0,.1) }
.card img { width:100% }
.info { padding:10px }
.title { font-weight:bold }
.artist { color:#555 }
/* –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–∏ —Å—Ç–∏–ª–∏ –≤ <style> */
.card img {
  height: 200px;
  width: 100%;
  object-fit: contain;
  background: linear-gradient(45deg, #f5f5f5 25%, #e0e0e0 25%, #e0e0e0 50%, #f5f5f5 50%, #f5f5f5 75%, #e0e0e0 75%);
  background-size: 20px 20px;
}

.title, .artist {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* –ö–Ω–æ–ø–∫–∞ –ø–æ–∏—Å–∫–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
button:hover {
  background: #0056b3;
  cursor: pointer;
}

/* –ü–æ–ª–µ –≤–≤–æ–¥–∞ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ */
input:focus {
  outline: none;
  border-color: #007bff;
  box-shadow: 0 0 0 2px rgba(0,123,255,.25);
}
</style>
</head>
<body>

<h2>–ü–æ–∏—Å–∫ —Ä–µ–ø—Ä–æ–¥—É–∫—Ü–∏–π</h2>
<input id="query" placeholder="Van Gogh / Starry Night">
<button onclick="search()">–ù–∞–π—Ç–∏</button>

<div id="results" class="results"></div>

<script>
async function search() {
  const q = document.getElementById('query').value.trim();
  if (!q) return;

  const results = document.getElementById('results');
  results.innerHTML = '<div style="text-align:center;padding:20px;">üîç –ò—â—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...</div>';

  // –ö–ª—é—á–µ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ ‚Ññ1: –¥–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –ø—Ä—è–º–æ –≤ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
  const searchQuery = q + ' filetype:jpg|jpeg|png|gif|webp';
  
  const url =
    'https://commons.wikimedia.org/w/api.php' +
    '?action=query' +
    '&generator=search' +
    '&gsrsearch=' + encodeURIComponent(searchQuery) +
    '&gsrnamespace=6' +
    '&gsrlimit=30' + // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ª–∏–º–∏—Ç
    '&prop=imageinfo' +
    '&iiprop=url|extmetadata|mime' + // –î–æ–±–∞–≤–ª—è–µ–º mime
    '&iiurlwidth=400' + // –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è –ø—Ä–µ–≤—å—é
    '&format=json' +
    '&origin=*';

  try {
    const res = await fetch(url);
    const data = await res.json();

    results.innerHTML = '';
    
    if (!data.query || !data.query.pages) {
      results.innerHTML = '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ';
      return;
    }

    const pages = Object.values(data.query.pages);
    let foundImages = 0;
    
    pages.forEach(page => {
      const img = page.imageinfo?.[0];
      if (!img?.url) return;
      
      // –ö–ª—é—á–µ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ ‚Ññ2: —Ñ–∏–ª—å—Ç—Ä—É–µ–º –ù–ï-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
      const fileName = page.title.toLowerCase();
      
      // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ–Ω—É–∂–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã
      const badExtensions = ['.svg', '.pdf', '.ogg', '.webm', '.mid', '.djvu', '.oga', '.ogv'];
      if (badExtensions.some(ext => fileName.endsWith(ext))) {
        return; // –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —ç—Ç–æ—Ç —Ñ–∞–π–ª
      }
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
      if (img.mime && !img.mime.startsWith('image/')) {
        return; // –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
      }
      
      // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–æ–ª—å–∫–æ JPG, PNG, GIF, WebP
      const goodExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.bmp'];
      if (!goodExtensions.some(ext => fileName.endsWith(ext))) {
        return; // –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –¥—Ä—É–≥–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã
      }
      
      foundImages++;
      
      const meta = img.extmetadata || {};
      const title = meta.ObjectName?.value || 
                   page.title.replace('File:', '').replace(/\.[^/.]+$/, '');
      const artist = meta.Artist?.value || '–ê–≤—Ç–æ—Ä –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω';
      const license = meta.LicenseShortName?.value || '';
      
      const card = document.createElement('div');
      card.className = 'card';
      
      card.innerHTML = `
        <img src="${img.url}" loading="lazy" alt="${title}" 
             onerror="this.src='https://via.placeholder.com/300x200?text=–û—à–∏–±–∫–∞+–∑–∞–≥—Ä—É–∑–∫–∏'">
        <div class="info">
          <div class="title" title="${title}">${title.length > 40 ? title.substring(0, 40) + '...' : title}</div>
          <div class="artist">${artist.length > 30 ? artist.substring(0, 30) + '...' : artist}</div>
          <div class="license">${license}</div>
        </div>
      `;
      
      results.appendChild(card);
    });
    
    if (foundImages === 0) {
      results.innerHTML = `
        <div style="text-align:center;padding:40px;color:#666;">
          <div style="font-size:48px;margin-bottom:20px;">üñºÔ∏è</div>
          <h3>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
          <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å, –Ω–∞–ø—Ä–∏–º–µ—Ä:<br>
          <i>Van Gogh, Monet, Leonardo da Vinci, landscape</i></p>
        </div>
      `;
    }
    
  } catch (e) {
    console.error(e);
    results.innerHTML = `
      <div style="text-align:center;padding:20px;color:#d32f2f;">
        –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.
      </div>
    `;
  }
}

// –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –Ω–∞–∂–∞—Ç–∏—é Enter
document.getElementById('query').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    search();
  }
});
</script>

</body>
</html>

