<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Muse ‚Äî –ø–æ–∏—Å–∫ —Ä–µ–ø—Ä–æ–¥—É–∫—Ü–∏–π</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { 
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
    padding:20px; 
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
}
.container {
    max-width: 1200px;
    margin: 0 auto;
    background: white;
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
}
h2 { 
    color: #333; 
    margin-bottom: 25px;
    text-align: center;
    font-weight: 300;
    letter-spacing: 1px;
}
.search-box {
    display: flex;
    gap: 10px;
    margin-bottom: 30px;
    justify-content: center;
}
input { 
    padding: 15px 20px; 
    width: 400px; 
    font-size: 16px; 
    border: 2px solid #e0e0e0; 
    border-radius: 50px; 
    transition: all 0.3s;
    outline: none;
}
input:focus { 
    border-color: #667eea; 
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}
button { 
    padding: 15px 30px; 
    font-size: 16px; 
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
    color:white; 
    border:none; 
    border-radius: 50px; 
    cursor:pointer;
    font-weight: 600;
    letter-spacing: 0.5px;
    transition: transform 0.2s, box-shadow 0.2s;
}
button:hover { 
    transform: translateY(-2px); 
    box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
}

.results {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 25px;
    margin-top: 30px;
}

.card { 
    background: white; 
    border-radius: 15px; 
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    transition: all 0.3s ease;
    overflow: hidden;
    cursor: pointer;
    border: 1px solid #f0f0f0;
}
.card:hover {
    transform: translateY(-10px);
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    border-color: #667eea;
}

.image-container {
    height: 220px;
    overflow: hidden;
    position: relative;
    background: #f8f9fa;
}

.image-container img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    transition: transform 0.5s ease;
}

.card:hover .image-container img {
    transform: scale(1.05);
}

.info { 
    padding: 20px; 
    border-top: 1px solid #f0f0f0;
}

.title { 
    font-weight: 600;
    font-size: 16px;
    color: #333;
    margin-bottom: 8px;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.artist { 
    color: #666;
    font-size: 14px;
    margin-bottom: 10px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px dashed #eee;
}

.license { 
    font-size: 12px; 
    color: #888;
    background: #f8f9fa;
    padding: 3px 8px;
    border-radius: 12px;
}

.year { 
    font-size: 12px; 
    color: #667eea;
    font-weight: 500;
}

.dimensions {
    position: absolute;
    bottom: 8px;
    right: 8px;
    background: rgba(0,0,0,0.7);
    color: white;
    padding: 3px 8px;
    border-radius: 12px;
    font-size: 11px;
    backdrop-filter: blur(5px);
}

.loading {
    text-align: center;
    padding: 60px 20px;
    color: #667eea;
    font-size: 18px;
}

.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #666;
}

.empty-state h3 {
    font-weight: 300;
    margin-bottom: 20px;
    color: #333;
}

.tips {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 20px;
    margin-top: 30px;
    border-left: 4px solid #667eea;
}

.tips h4 {
    color: #333;
    margin-bottom: 10px;
    font-weight: 600;
}

.tips ul {
    list-style: none;
    padding: 0;
    margin: 0;
    color: #666;
    line-height: 1.8;
}

.tips li:before {
    content: "‚Ä¢";
    color: #667eea;
    font-weight: bold;
    display: inline-block;
    width: 1em;
    margin-left: -1em;
}
</style>
</head>
<body>

<div class="container">
    <h2>üé® Muse ‚Äî –ü–æ–∏—Å–∫ —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–π</h2>
    
    <div class="search-box">
        <input id="query" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è —Ö—É–¥–æ–∂–Ω–∏–∫–∞ –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω—ã...">
        <button onclick="search()">–ü–æ–∏—Å–∫</button>
    </div>

    <div id="results" class="results"></div>
</div>

<script>
// –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–∏—Å–∫ –ø–æ –Ω–∞–∂–∞—Ç–∏—é Enter
document.getElementById('query').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        search();
    }
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ HTML –∏–∑ —Ç–µ–∫—Å—Ç–∞
function cleanText(text) {
    if (!text) return '';
    
    // –£–¥–∞–ª—è–µ–º –≤—Å–µ HTML —Ç–µ–≥–∏
    text = text.replace(/<[^>]*>/g, ' ');
    
    // –£–¥–∞–ª—è–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã, –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –ø—Ä–æ–±–µ–ª—ã –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –∑–Ω–∞–∫–∏ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è
    text = text.replace(/[^\w\s\u0400-\u04FF.,!?;:'"()\-‚Äì‚Äî]/gu, ' ');
    
    // –ó–∞–º–µ–Ω—è–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã –Ω–∞ –æ–¥–∏–Ω
    text = text.replace(/\s+/g, ' ').trim();
    
    // –û–±—Ä–µ–∑–∞–µ–º —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
    if (text.length > 200) {
        text = text.substring(0, 200) + '...';
    }
    
    return text;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è HTML
function escapeHtml(text) {
    if (!text) return '';
    return text
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –≥–æ–¥–∞ –∏–∑ –¥–∞—Ç—ã
function extractYear(dateStr) {
    if (!dateStr) return '';
    
    // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –≥–æ–¥ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö
    const yearMatch = dateStr.match(/\b\d{4}\b/);
    return yearMatch ? yearMatch[0] : '';
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —á–∏—Å—Ç–æ–≥–æ –∏–º–µ–Ω–∏ —Ö—É–¥–æ–∂–Ω–∏–∫–∞
function getCleanArtist(meta) {
    // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –ø–æ–ª—è –≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
    const artistFields = [
        meta.Artist?.value,
        meta.Creator?.value,
        meta.Author?.value,
        meta.Painter?.value
    ];
    
    for (const field of artistFields) {
        if (field && field.trim()) {
            const clean = cleanText(field);
            if (clean && clean !== 'Unknown') {
                return clean;
            }
        }
    }
    
    return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ö—É–¥–æ–∂–Ω–∏–∫';
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —á–∏—Å—Ç–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è
function getCleanTitle(pageTitle, meta) {
    // –ü—Ä–æ–±—É–µ–º –ø–æ–ª–µ ObjectName
    if (meta.ObjectName?.value) {
        const clean = cleanText(meta.ObjectName.value);
        if (clean && clean.trim()) {
            return clean;
        }
    }
    
    // –ü—Ä–æ–±—É–µ–º –ø–æ–ª–µ ImageDescription
    if (meta.ImageDescription?.value) {
        const clean = cleanText(meta.ImageDescription.value);
        if (clean && clean.trim()) {
            return clean;
        }
    }
    
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
    let title = pageTitle
        .replace('File:', '')
        .replace(/\.[^/.]+$/, '') // –£–¥–∞–ª—è–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
        .replace(/_/g, ' ')
        .replace(/\([^)]*\)/g, '') // –£–¥–∞–ª—è–µ–º —Ç–µ–∫—Å—Ç –≤ —Å–∫–æ–±–∫–∞—Ö
        .replace(/^\d+\s*[-‚Äì]\s*/, '') // –£–¥–∞–ª—è–µ–º —Ü–∏—Ñ—Ä—ã –≤ –Ω–∞—á–∞–ª–µ
        .replace(/\bby\b|\b–∏–∑\b/gi, '') // –£–¥–∞–ª—è–µ–º "by", "–∏–∑"
        .replace(/\b(a|an|the)\b/gi, '') // –£–¥–∞–ª—è–µ–º –∞—Ä—Ç–∏–∫–ª–∏
        .replace(/\s+/g, ' ')
        .trim();
    
    // –ï—Å–ª–∏ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ, –æ–±—Ä–µ–∑–∞–µ–º
    if (title.length > 50) {
        title = title.substring(0, 50) + '...';
    }
    
    return title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
}

async function search() {
    const q = document.getElementById('query').value.trim();
    if (!q) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å');
        return;
    }

    const results = document.getElementById('results');
    results.innerHTML = `
        <div class="loading">
            <div style="font-size:48px;margin-bottom:20px;">üé®</div>
            <div>–ò—â—É –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∏—Å–∫—É—Å—Å—Ç–≤–∞...</div>
        </div>
    `;

    // –ë–æ–ª–µ–µ —Ü–µ–ª–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
    const searchQueries = [
        `"${q}" painting`,  // –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ + painting
        `${q} oil on canvas`,
        `"${q}" artwork`,
        `${q} –∫–∞—Ä—Ç–∏–Ω—ã`,      // –î–ª—è —Ä—É—Å—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
        `${q} picture`
    ];

    let allPages = [];
    
    // –ü—Ä–æ–±—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
    for (const searchQuery of searchQueries) {
        const url =
            'https://commons.wikimedia.org/w/api.php' +
            '?action=query' +
            '&generator=search' +
            '&gsrsearch=' + encodeURIComponent(searchQuery) +
            '&gsrnamespace=6' +
            '&gsrlimit=20' + // –ú–µ–Ω—å—à–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –Ω–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–µ–µ
            '&prop=imageinfo' +
            '&iiprop=url|extmetadata|mime|size|dimensions' +
            '&iiurlwidth=800' +
            '&format=json' +
            '&origin=*';

        try {
            const res = await fetch(url);
            const data = await res.json();
            
            if (data.query?.pages) {
                const pages = Object.values(data.query.pages);
                allPages = allPages.concat(pages);
            }
            
            if (allPages.length >= 30) break;
            
        } catch (e) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', e);
        }
        
        await new Promise(resolve => setTimeout(resolve, 100));
    }

    // –£–¥–∞–ª—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã
    const uniquePages = [];
    const seenTitles = new Set();
    
    allPages.forEach(page => {
        if (!seenTitles.has(page.title)) {
            seenTitles.add(page.title);
            uniquePages.push(page);
        }
    });

    // –°—Ç—Ä–æ–≥–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
    const filteredPages = uniquePages.filter(page => {
        const img = page.imageinfo?.[0];
        if (!img?.url) return false;
        
        // –¢–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        if (!img.mime?.startsWith('image/')) return false;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
        const fileName = page.title.toLowerCase();
        const badExtensions = ['.svg', '.pdf', '.ogg', '.webm', '.tiff', '.ico', '.svgz'];
        if (badExtensions.some(ext => fileName.endsWith(ext))) return false;
        
        // –ò—Å–∫–ª—é—á–∞–µ–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –º—É–∑–µ–µ–≤, –≤—ã—Å—Ç–∞–≤–æ–∫ –∏ —Ç.–¥.
        const skipWords = [
            'museum', 'gallery', 'exhibition', 'expo', 'hall',
            'frame', 'framed', 'photo', 'photograph', 'photography',
            'photographer', 'scan', 'scanned', 'cropped', 'thumbnail',
            'thumb', 'icon', 'logo', 'signature', 'stamp', 'poster',
            'ticket', 'map', 'diagram', 'graph', 'chart', 'building',
            'exterior', 'interior', 'room', 'wall', 'ceiling',
            'selfie', 'portrait photo', 'photographic'
        ];
        
        const title = page.title.toLowerCase();
        const meta = img.extmetadata || {};
        const desc = (meta.ImageDescription?.value || '').toLowerCase();
        
        if (skipWords.some(word => title.includes(word) || desc.includes(word))) {
            return false;
        }
        
        // –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–æ–ª—å—à–∏–º
        if (img.size && img.size < 80000) return false;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω
        if (img.width && img.height) {
            const ratio = img.width / img.height;
            if (ratio < 0.5 || ratio > 3) return false;
            if (img.width < 600 || img.height < 400) return false;
        }
        
        return true;
    });

    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Ä–∞–∑–º–µ—Ä—É —Ñ–∞–π–ª–∞
    filteredPages.sort((a, b) => {
        const sizeA = a.imageinfo?.[0]?.size || 0;
        const sizeB = b.imageinfo?.[0]?.size || 0;
        return sizeB - sizeA;
    });

    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    results.innerHTML = '';
    
    if (filteredPages.length === 0) {
        results.innerHTML = `
            <div class="empty-state">
                <div style="font-size:72px;margin-bottom:20px;">üé®</div>
                <h3>–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∏—Å–∫—É—Å—Å—Ç–≤–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å:</p>
                <div class="tips">
                    <h4>–ü—Ä–∏–º–µ—Ä—ã —Ö–æ—Ä–æ—à–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:</h4>
                    <ul>
                        <li><strong>–ò–ª—å—è –†–µ–ø–∏–Ω</strong> (Ilya Repin)</li>
                        <li><strong>–ò–≤–∞–Ω –ê–π–≤–∞–∑–æ–≤—Å–∫–∏–π</strong> (Ivan Aivazovsky)</li>
                        <li><strong>–í–∏–Ω—Å–µ–Ω—Ç –≤–∞–Ω –ì–æ–≥</strong> (Vincent van Gogh)</li>
                        <li><strong>–ë—É—Ä–ª–∞–∫–∏ –Ω–∞ –í–æ–ª–≥–µ</strong> (Barge Haulers)</li>
                        <li><strong>–î–µ–≤—è—Ç—ã–π –≤–∞–ª</strong> (The Ninth Wave)</li>
                    </ul>
                </div>
            </div>
        `;
        return;
    }

    // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ —Å —á–∏—Å—Ç—ã–º —Ç–µ–∫—Å—Ç–æ–º
    filteredPages.slice(0, 20).forEach(page => {
        const img = page.imageinfo[0];
        const meta = img.extmetadata || {};
        
        // –ü–æ–ª—É—á–∞–µ–º —á–∏—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ
        const title = getCleanTitle(page.title, meta);
        const artist = getCleanArtist(meta);
        const year = extractYear(meta.Date?.value || meta.CreationDate?.value || '');
        
        // –ü–æ–ª—É—á–∞–µ–º –ª–∏—Ü–µ–Ω–∑–∏—é (—É–ø—Ä–æ—â–µ–Ω–Ω—É—é)
        let license = 'CC';
        if (meta.LicenseShortName?.value) {
            const licenseText = cleanText(meta.LicenseShortName.value);
            if (licenseText.includes('CC')) {
                license = 'CC';
            } else if (licenseText.includes('PD')) {
                license = 'Public Domain';
            }
        }
        
        const card = document.createElement('div');
        card.className = 'card';
        
        card.innerHTML = `
            <div class="image-container">
                <img src="${escapeHtml(img.url)}" 
                     loading="lazy" 
                     alt="${escapeHtml(title)}"
                     onerror="this.onerror=null; this.style.opacity='0.5'">
                ${img.width && img.height ? 
                    `<div class="dimensions">${img.width}√ó${img.height}</div>` : ''}
            </div>
            <div class="info">
                <div class="title" title="${escapeHtml(title)}">${escapeHtml(title)}</div>
                <div class="artist" title="${escapeHtml(artist)}">${escapeHtml(artist)}</div>
                <div class="meta">
                    <span class="license">${escapeHtml(license)}</span>
                    ${year ? `<span class="year">${escapeHtml(year)}</span>` : ''}
                </div>
            </div>
        `;
        
        card.onclick = () => {
            window.open(`https://commons.wikimedia.org/wiki/${encodeURIComponent(page.title)}`, '_blank');
        };
        
        results.appendChild(card);
    });

    // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–≤–µ—Ç—ã
    const tips = document.createElement('div');
    tips.className = 'tips';
    tips.innerHTML = `
        <h4>üéØ –°–æ–≤–µ—Ç—ã –ø–æ –ø–æ–∏—Å–∫—É:</h4>
        <ul>
            <li><strong>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è</strong> –¥–ª—è –ª—É—á—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</li>
            <li><strong>–î–ª—è —Ä—É—Å—Å–∫–∏—Ö —Ö—É–¥–æ–∂–Ω–∏–∫–æ–≤:</strong> "Ilya Repin", "Ivan Aivazovsky"</li>
            <li><strong>–î–ª—è –∫–∞—Ä—Ç–∏–Ω:</strong> –¥–æ–±–∞–≤—å—Ç–µ "painting" –∏–ª–∏ "–∫–∞—Ä—Ç–∏–Ω–∞"</li>
            <li><strong>–ü—Ä–∏–º–µ—Ä—ã:</strong> "Repin paintings", "Van Gogh sunflowers"</li>
        </ul>
    `;
    
    results.appendChild(tips);
}
</script>

</body>
</html>