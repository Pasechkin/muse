# Инструкции для ИИ-агента

## ⚠️ ВАЖНО: Прочитай перед началом работы

### 1. Ознакомься с документацией

**ОБЯЗАТЕЛЬНО прочитай эти файлы перед началом работы:**

| Файл | Что содержит |
|------|--------------|
| `docs/DESIGN_SYSTEM.md` | Цвета, типографика, компоненты и правила рефакторинга — **ОСНОВНОЙ ИСТОЧНИК** |
| `docs/PAGES_LIST.md` | Статус всех страниц проекта |
| `docs/AUDIT_PAGE_COMPLIANCE.md` | Инструкция для ИИ: как аудировать соответствие страницы правилам |

### 2. НЕ изменяй документацию

❌ **ЗАПРЕЩЕНО** изменять файлы документации (`*.md`) без явного согласования с пользователем.

Если считаешь, что нужно что-то добавить в документацию — **сначала спроси**.

### 3. Эталоны по группам страниц

Эталоны:
- Главные страницы — `src/html/index.html`
- Стили портретов — `src/html/portret-na-zakaz/style/portret-maslom.html`
- Объекты портретов — `src/html/portret-na-zakaz/object/muzhskoy-portret.html`
- Блог — `src/html/blog/kollazh-i-fotokollazh.html`
- Info — `src/html/info/kontakty.html`
- Остальные страницы — ориентир `src/html/index.html` с учетом уникальности

Бери из эталона своей группы:
- Структуру документа (head/body)
- Минимальный критический CSS
- Подключение CSS/скриптов

Навигация по секциям (если нужна на странице): **Page Navigator** — `<nav class="page-navigator">`.

---

## Правила работы с контентом

### Источник контента

- **Источник:** Контент берём ТОЛЬКО с оригинала `muse.ooo`
- **Тексты:** НЕ менять, НЕ сокращать, НЕ перефразировать
- **Alt/Title:** Сохранять полностью, не укорачивать
- **Meta:** Title и description — 1:1 с оригинала

### Плейсхолдеры (маркеры в HTML)

В некоторых текущих страницах уже встречаются маркеры вида `[ТЕКСТ: ...]`, `[URL_...]`, `[ALT текст]`.

- **Это допустимо:** если такие маркеры уже есть в исходной странице/эталоне — **оставлять как есть**.
- **Запрещено:** придумывать значения вместо маркеров (не заменять на "свой" текст/URL/alt/title).
- **Новые маркеры:** добавлять только если пользователь явно разрешил или если в оригинале/эталоне реально нет значения и нужно пометить место для дальнейшего заполнения.

### Предупреждай об изменениях

Если что-то нужно изменить или убрать — **СНАЧАЛА СПРОСИ**.

Если количество элементов отличается от оригинала — **ПРЕДУПРЕДИ**.

### ⚠️ НЕ сокращай код без предупреждения

❌ **ЗАПРЕЩЕНО** сокращать, упрощать или "оптимизировать" JavaScript, CSS или HTML без явного согласования.

Примеры запрещённых действий:
- Убирать "лишние" обработчики событий
- Упрощать логику скриптов
- Удалять "ненужные" проверки и защиты
- Сокращать CSS правила

**Если считаешь, что код можно упростить — СНАЧАЛА СПРОСИ и объясни что именно хочешь убрать.**

---

## Критический CSS

Критический CSS — минимальный набор стилей для корректного отображения до загрузки основного CSS (собранного Tailwind, например `css/output.css`).

### Обязательные стили:

```css
/* CSS переменные для цветов */
:root {
    --primary: #4A90E2;
    --primary-hover: #609DE6;
    --dark: #252525;
    --body: #666666;
    --secondary: #FAFAFA;
}

/* Body */
body {
    background-color: #fff;
    color: var(--body);
    overflow-x: hidden;
}

/* Screen reader only */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}
```

### Добавлять по необходимости:

| Компонент | Когда добавлять |
|-----------|-----------------|
| `.page-navigator` | Если есть боковая навигация |
| `.carousel-scroll` | Если есть карусели |
| `.ba-card` | Если есть слайдер "До/После" |
| `.canvas-3d` | Если есть 3D-эффект на изображениях |
| Ken Burns (`@keyframes kenburns`) | Если есть анимация Hero-изображения |

**Полные стили компонентов см. в `docs/DESIGN_SYSTEM.md`**

### ⚠️ Цвета — с перевёрстываемой страницы

Цвета берём со страницы, которую перевёрстываем, НЕ из эталона группы!

---

## Скрипты

### Общие скрипты

Подключаются через внешний файл:

```html
<script src="js/nav.js"></script>
<!-- или для вложенных папок: -->
<script src="../../js/nav.js"></script>
```

**Канон (порядок подключения скриптов):** ставим перед `</body>`.

Если на странице есть `el-*` компоненты — подключаем Tailwind Plus Elements **перед** `nav.js`:

```html
<!-- Tailwind Plus Elements (только если используются el-*) -->
<script type="module" src="js/tailwindplus-elements.js"></script>

<!-- Общий скрипт проекта -->
<script src="js/nav.js"></script>
```

Для вложенных папок:

```html
<script type="module" src="../../js/tailwindplus-elements.js"></script>
<script src="../../js/nav.js"></script>
```

`js/nav.js` — общий скрипт проекта (page navigator, back-to-top, video cover, carousel).

**Что конкретно делает `js/nav.js` (важно):**
- `window.BxPopup(url, width, height)` — глобальный helper для совместимости со старыми inline `onclick`.
- **Маска телефона (RU):** автоматически применяется к `input[type="tel"]` и форматирует ввод как `+7 (___) ___-__-__`.
- **Page Navigator:**
    - плавный скролл по `.page-navigator .inner-link`;
    - подсветка активной секции при скролле;
    - скрытие/показ `.page-navigator` на десктопе (по ширине окна).
- **Back to Top:**
    - ожидает элемент `#back-to-top`;
    - показывает/скрывает кнопку по скроллу/брейкпоинту;
    - плавно скроллит наверх по клику.
- **Video Cover:**
    - по клику на `[data-video-cover] [data-play-btn]` создаёт `iframe` с `autoplay=1`;
    - добавляет класс `video-playing`.
- **Доступность `<dialog>`:**
    - обёртка `showModal/close` (возврат фокуса, `Escape`, focus-trap);
    - проставляет `role="dialog"`, `aria-modal`, `aria-labelledby` (если возможно);
    - добавляет `aria-label` для кнопок закрытия и контролов воспроизведения.
- **Carousel Scroll (`.carousel-scroll`):**
    - горизонтальная прокрутка колесом на десктопе;
    - drag-to-scroll с защитой от случайного клика;
    - поддержка кнопок `.js-carousel-prev/.js-carousel-next`;
    - добавляет ARIA (`role=list/listitem`) и `sr-only` инструкцию;
    - при отсутствии кнопок может автоматически добавить Prev/Next в ближайший wrapper.
- **Before/After (`.before-after-slider` / `.ba-card`):**
    - синхронизирует `input[type="range"]` с CSS-переменной `--pos` и позициями handle/divider.

**Важно:** `nav.js` должен оставаться безопасным для страниц без этих блоков — он сам проверяет наличие селекторов.

### Fallback для `el-*` (Tabs/Disclosure/Dialog)

В проекте мы ориентируемся на современные браузеры с поддержкой `type="module"`.

- Если на странице найден page-specific fallback‑код для `el-*` компонентов (например `ensureTabsFallback` для `el-tab-group`) — **рекомендуем удалять этот код**.
- Причина: поведение `el-*` обеспечивается `js/tailwindplus-elements.js`; отдельные “самописные” фолбэки на страницах засоряют разметку и усложняют поддержку.
- Исключения возможны только по явной договорённости (если решим поддерживать браузеры без модулей).

### Tailwind Plus Elements (вендорный скрипт)

Если на странице используются компоненты `el-*` (например `el-dialog`, `el-tab-group`, `el-disclosure`) — подключаем **отдельно**:

```html
<script type="module" src="js/tailwindplus-elements.js"></script>
```

Файл `js/tailwindplus-elements.js` — локальная сборка `@tailwindplus/elements` (минифицированный вендор). **Не редактировать**, не "рефакторить" и не переносить код в `nav.js`.

Если нужно изменить поведение Tailwind Plus Elements — сначала обсуждаем (обычно решается разметкой/атрибутами `el-*` или обвязкой в нашем JS, а не правкой вендорного файла).

**Принцип:** перед тем как писать новый JS для типовых UI-компонентов, сначала проверяем Tailwind Plus Elements.

**Что включено в Tailwind Plus Elements (для этой версии):**
- Introduction
- Autocomplete → `el-autocomplete`
- Command palette → `el-command-palette`
- Copy button → `el-copyable`
- Dialog → `el-dialog`
- Disclosure → `el-disclosure`
- Dropdown menu → `el-dropdown` + `el-menu`
- Popover → `el-popover`
- Select → `el-select`
- Tabs → `el-tab-group`

**Decision flow (что делать с интерактивом):**
1) Есть нужный компонент в списке выше → используем `el-*` и не пишем новый JS.
2) Нет в Plus, но логика повторится на 2+ страницах → добавляем в `js/nav.js` и документируем HTML-хук.
3) Уникально для одной страницы → допускается короткий inline page-specific JS с guard-проверками.

- Если задача — *модалка/диалог, табы, аккордеон/FAQ* — почти всегда это уже закрывается `el-dialog`, `el-tab-group`, `el-disclosure`.
- Если нужен новый интерактивный элемент, который похож на типовой компонент UI — сначала ищем готовый `el-*` в документации Tailwind Plus Elements (на их странице есть перечень компонентов). Тогда чаще всего **не нужен** новый самописный JS — нужна корректная разметка `el-*` и стили.
- Самописный JS пишем, когда:
    - логика строго бизнес‑специфична и её нет в Plus;
    - или нужно дополнить поведение (обвязкой вокруг `el-*`), не трогая вендорный файл.

`nav.js` подключать по умолчанию; Tailwind Plus Elements подключать **только если** на странице реально используются `el-*`.

### Page-specific JS (скрипты только для отдельных страниц)

- Допускается добавлять **только если** логика реально уникальна для страницы и не повторяется в других шаблонах.
- Если код короткий и привязан к конкретной секции — можно inline в конце страницы, но **обязательно** с проверками `querySelector(...)` и без глобальных переменных.
- Если логика начинает повторяться на 2+ страницах — переносим в `js/nav.js` (или обсуждаем отдельный модуль) и документируем хук (класс/`data-*`).

### Inline-скрипты (добавлять по необходимости)

Inline-скрипты — **не дефолтный путь**. Почти весь типовой интерактив уже закрыт:
- Tailwind Plus Elements (компоненты `el-*`)
- общий `js/nav.js`

Inline допускается **только** для реально уникальной логики одной страницы:
- коротко;
- без глобальных переменных;
- с guard-проверками (`if (!el) return;`);
- без дублирования того, что уже есть в `js/nav.js`.

**Важно:** не добавляем inline JS для типовых блоков — это уже реализовано в `js/nav.js`:
- **Video Cover** (`[data-video-cover]`) — ленивое создание `iframe` по клику на `[data-play-btn]`, источник берётся из `data-video-src`.
- **Carousel Scroll** (`.carousel-scroll`) — wheel + drag + защита от случайного клика + кнопки prev/next + ARIA.

Если в старых страницах встретился legacy inline-код для этих блоков — при правках страницы его нужно убирать/переводить на канон `nav.js`, а не копировать дальше.

### Временные костыли (fallback JS/CSS)

Иногда допустимо добавить временный fallback (например, чтобы страница работала, пока не стабилизировали `el-*` или разметку).

- **Только по согласованию:** если нужен fallback — сначала согласуем.
- **Только локально и узко:** привязка к конкретной странице/секции (селектор/`data-*`), без глобального влияния на весь сайт.
- **Без правки вендора:** `js/tailwindplus-elements.js` не редактируем.
- **С обязательным планом удаления:** в `PROJECT.md` фиксируем что добавили, где, почему и при каком условии удаляем.

---

## Базовые правила

### Шрифты
Используем **только системные шрифты устройства/операционной системы** (system font stack).

Запрещено подключать веб‑шрифты: Google Fonts, файлы `.woff/.woff2`, `@font-face`, preload шрифтов.

**Фактический стек шрифта (из `src/input.css`, `--font-sans`):**
`system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"`.

### Ширина контейнера
`1170px` на десктопе. Используй класс `container` (настроен в CSS).

**Запрещено:** вкладывать `.container` в `.container` (не делаем «контейнер в контейнере»).

Если нужен внешний фон на всю ширину — делай секцию на всю ширину, а внутри один `.container`.

### SVG
Только inline-`<svg>` (не используем `<img src="...svg">` и не подключаем внешние SVG-файлы).

### Брейкпоинты
Стандартные Tailwind: `sm: 640px`, `md: 768px`, `lg: 1024px`, `xl: 1280px`, `2xl: 1536px`.

### Хлебные крошки
Разделитель — символ `/` (не стрелка).

### Ссылки в тексте
- Стиль: `text-primary underline hover:no-underline`
- Стрелки: `↑` (вверх по странице), `↓` (вниз), `↗` (внешняя/другая страница)

---

## Изображения

| Атрибут | Правило |
|---------|---------|
| Формат | `.webp` |
| `width` | Обязательно (в пикселях) |
| `height` | Обязательно (в пикселях) |
| `loading` | `lazy` (кроме первого экрана) |
| `decoding` | `async` |
| `fetchpriority` | `high` — только для LCP/первого экрана (когда реально нужно) |
| `alt` | С оригинала, НЕ сокращать |
| `title` | Если есть на оригинале — сохранить |

Правило для первого экрана (производительность):
- У LCP-изображения **не должно** быть `loading="lazy"` (обычно `loading="eager"` или убрать `loading`).
- `rel="preload" as="image"` добавляем только после проверки необходимости (DevTools/Lighthouse). Часто достаточно `fetchpriority="high"`.

CSS `background-image`:
- Используем только для декоративных фонов.
- Если это контентное изображение или LCP первого экрана — делаем через `<img>`/`<picture>`, не через фон.

`srcset`/`sizes`:
- Пока на рассмотрении (не обязательное правило) — вернёмся, когда утвердим стратегию.

---

## Видео

| Атрибут | Правило |
|---------|---------|
| `preload` | `none` (всегда) |
| `playsinline` | Да |
| `muted` | Обязательно для автовоспроизведения |

❌ **Запрещено:**
- `webkit-playsinline` (невалидный атрибут)
- `loading="lazy"` на `<video>` (невалидный атрибут)

---

## Формы и accessibility

### Формы
- Каждый `<input>` и `<select>` должен иметь `<label>`
- Если placeholder достаточен — использовать `sr-only` для скрытия label

#### Отправка форм (текущее состояние)

Сейчас формы **никуда не отправляем**:
- Не добавлять фейковые `action`/endpoint и не писать `fetch()`/AJAX‑отправку.
- Разрешён только статичный HTML формы + стили.

#### Маски (обязательно)

Для телефона используем `type="tel"` и **общую маску из `js/nav.js`** (без внешних библиотек): ввод автоматически приводится к формату `+7 (___) ___-__-__`.

Для остальных полей маски не используем:
- **E-mail:** `type="email"` + нативная валидация браузера (без масок/JS-валидаторов).
- **Имя/Фамилия:** `type="text"` (без масок). При необходимости можно добавить `autocomplete="given-name"` / `autocomplete="family-name"`.

### Ссылки
- Текстовые ссылки должны иметь `underline` (для различимости)

---

## Тестирование

### Локально (эталон)
**Эталонный предпросмотр — VS Code Live Server** (открываем страницы из `src/html/...`).

### Локально (дополнительно)
`start-mobile-server.bat` — только для мобильной проверки/доступа по сети (не эталон).

### Деплой
`БЫСТРЫЙ_ДЕПЛОЙ.bat`

### Валидация HTML
После завершения — проверить через [W3C Validator](https://validator.w3.org/nu/).

---

## Чек-лист перед завершением

- [ ] Контент совпадает с оригиналом `muse.ooo`
- [ ] Количество элементов совпадает (примеры, FAQ, преимущества)
- [ ] `.container` не вложен в `.container` (без двойных обёрток)
- [ ] Изображения: webp, width, height, loading, decoding, alt
- [ ] SVG: только inline `<svg>`
- [ ] Видео: preload="none", muted для автоплея
- [ ] Формы: label для каждого поля
- [ ] Ссылки: underline для текстовых ссылок
- [ ] Кнопка "Наверх" (Back to Top) присутствует
- [ ] Скрипты: по умолчанию подключён `js/nav.js`; `js/tailwindplus-elements.js` подключён только при `el-*` и стоит перед `nav.js`
- [ ] Inline-скрипты добавлены только если нужна уникальная логика одной страницы (Video Cover и Carousel Scroll — без inline, через `js/nav.js`)
- [ ] CSS собран из `src/input.css` и при необходимости обновлена копия для предпросмотра (`src/html/css/output.css`)
- [ ] HTML валидация пройдена
